Résumé du Framework Java MVC minimal
====================================

Objectif global
---------------
Ce framework fournit un mini-MVC basé sur des annotations pour des applications web Jakarta :
- Les classes contrôleurs sont annotées avec @ControllerAnnotation.
- Les méthodes exposées sont annotées avec @HandleUrl.
- Le FrontServlet scanne dynamiquement un package pour trouver ces contrôleurs et mappe les URLs vers les méthodes.
- Les méthodes peuvent retourner soit une String (réponse texte) soit un ModelView (vue + données vers une JSP).

1) Package com.annotations
--------------------------

1.1 ControllerAnnotation
- Type : annotation de classe (@interface).
- Rôle : marquer une classe comme contrôleur du framework.
- Élément : String value() default "";
  - Permet de donner un préfixe d’URL au contrôleur (ex: "/controller2").

1.2 HandleUrl
- Type : annotation de méthode (@interface).
- Rôle : associer une URL à une méthode de contrôleur.
- Élément : String value() default "";
  - Valeur de l’URL relative, utilisée comme clé dans la map de mappings.

2) Package com.classes
----------------------

2.1 ModelView
- Rôle : objet de retour pour les méthodes de contrôleur qui doivent afficher une vue (JSP) avec des données.
- Champs :
  - String view : chemin de la vue (par ex. "user.jsp").
  - Map<String, Object> data : données à transmettre à la JSP.
- Méthodes principales :
  - getView() / setView(String view)
    - Accès/maj du chemin de la vue.
  - getData() / setData(Map<String, Object> data)
    - Accès/maj de la map de données.
  - addData(String key, Object value)
    - Ajoute une paire clé/valeur au modèle (par exemple nom, age, etc.).

3) Package com.utils
--------------------

3.1 MappingHandler
- Rôle : stocker le couple (classe contrôleur, méthode) associé à une URL.
- Champs :
  - Class<?> classe : type du contrôleur.
  - Method methode : méthode à appeler quand l’URL correspond.
- Méthodes principales :
  - Constructeur vide : MappingHandler().
  - Constructeur complet : MappingHandler(Class<?> classe, Method methode)
    - Initialise la classe et la méthode.
  - getClasse() / setClasse(Class<?> classe)
    - Accès/maj de la classe contrôleur.
  - getMethode() / setMethode(Method methode)
    - Accès/maj de la méthode associée.

3.2 ScanningUrl
- Rôle : scanner un package donné pour trouver toutes les classes contrôleurs et construire la map URL → MappingHandler.
- Méthodes principales :
  - getClasses(String packageName)
    - Transforme le nom de package en chemin (ex: "test.java" → "test/java").
    - Utilise le ClassLoader pour trouver la ressource correspondante.
    - Parcourt le répertoire trouvé pour lister toutes les classes .class et les charger.
  - findClasses(File directory, String packageName)
    - Parcourt récursivement le répertoire pour retrouver toutes les classes du package et sous-packages.
  - scanUrlMappings(String packageName)
    - Appelle getClasses(packageName) pour récupérer toutes les classes.
    - Garde uniquement celles annotées avec @ControllerAnnotation.
    - Parcourt leurs méthodes pour trouver celles annotées avec @HandleUrl.
    - Pour chaque méthode annotée, lit la valeur de @HandleUrl et crée un MappingHandler(classe, methode).
    - Remplit une Map<String, MappingHandler> où la clé est l’URL.

4) Package com.framework
------------------------

4.1 FrontServlet (extends HttpServlet)
- Rôle : servlet frontal du framework, point d’entrée unique.
  - Scanne les contrôleurs au démarrage.
  - Intercepte toutes les requêtes.
  - Décide si on sert un fichier statique/JSP ou si on appelle un contrôleur.

- Champs :
  - RequestDispatcher defaultDispatcher : dispatcher nommé "default" pour déléguer au servlet par défaut (fichiers statiques, JSP).
  - List<String> INDEX_FILES : liste des fichiers index possibles ("/index.html", "/index.htm", "/index.jsp").

- Méthodes principales :

  4.1.1 init()
  - Appelée au démarrage du servlet.
  - Récupère le dispatcher par défaut du contexte.
  - Appelle ScanningUrl.scanUrlMappings("test.java") pour scanner le package des contrôleurs.
  - Stocke la map URL → MappingHandler dans le ServletContext sous la clé "urlMappings".

  4.1.2 service(HttpServletRequest req, HttpServletResponse res)
  - Méthode centrale appelée pour chaque requête HTTP.
  - Calcule le path en enlevant le contextPath de l’URI.
  - Si path est "/" ou vide :
    - Cherche un index via findExistingIndex().
    - Si trouvé, forward vers ce fichier.
    - Sinon, appelle customServe() pour renvoyer une page d’erreur HTML simple.
  - Sinon :
    - Récupère le MappingHandler correspondant au path à partir de la map urlMappings.
    - Vérifie si une ressource physique existe (getResource(path) != null).
    - Cas 1 : resourceExists → defaultServe(req, res) (JSP ou fichier statique).
    - Cas 2 : pas de ressource mais mapping trouvé → handleMapping() pour appeler le contrôleur.
    - Cas 3 : ni ressource ni mapping → customServe().

  4.1.3 handleMapping(HttpServletRequest req, HttpServletResponse res, MappingHandler mapH)
  - Récupère le type de retour de la méthode (String ou ModelView).
  - Instancie la classe contrôleur (constructeur par défaut).
  - Invoque la méthode cible sans paramètres (version simple).
  - Si retour = String :
    - Écrit le texte directement dans la réponse (text/plain, UTF-8).
  - Si retour = ModelView :
    - Récupère le ModelView.
    - Pour chaque entrée de mv.getData(), fait req.setAttribute(cle, valeur).
    - Forward vers mv.getView() (par ex. "user.jsp").
  - Sinon :
    - Écrit un message d’erreur textuel indiquant que le type n’est pas géré.

  4.1.4 findExistingIndex()
  - Parcourt la liste INDEX_FILES.
  - Teste pour chaque fichier si la ressource existe dans le contexte.
  - Retourne le premier chemin trouvé ou null.

  4.1.5 customServe(HttpServletRequest req, HttpServletResponse res)
  - Construit et renvoie une petite page HTML indiquant qu’aucun fichier ou URL correspondant n’a été trouvé.
  - Affiche l’URL demandée.

  4.1.6 defaultServe(HttpServletRequest req, HttpServletResponse res)
  - Si defaultDispatcher n’est pas null, forward la requête vers le servlet par défaut du serveur.
  - Sinon, appelle customServe().

Utilisation typique avec le projet test
--------------------------------------
- Le JAR du framework est placé dans WEB-INF/lib d’une appli web.
- web.xml mappe FrontServlet sur "/" ou "/*".
- Le package des contrôleurs (ex: "test.java") est scanné au démarrage.
- Les méthodes annotées @HandleUrl peuvent retourner :
  - String → réponse texte directe.
  - ModelView → forward vers une JSP en passant des attributs de requête.
